"use strict";angular.module("emotebuilderApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("emotebuilderApp").controller("MainCtrl",["$scope",function(a){a.emoteInfo=new EmoteInfo,a.emoteInfoSerializer=new EmoteInfoSerializer,a.sampleData=[{apng_url:"http://backstage.berrytube.tv/marminator/images/a/-UJ20dLxrm_8r4kr.png","background-image":"http://a.thumbs.redditmedia.com/-UJ20dLxrm_8r4kr.png",height:140,names:["welliwashungryandwhenyoucravehands"],sr:"marmemotes",tags:["lyra"],width:126},{apng_url:"http://backstage.berrytube.tv/marminator/images/a/1ERLWojxsUO7nFQT.png","background-image":"http://a.thumbs.redditmedia.com/1ERLWojxsUO7nFQT.png",height:140,names:["doodoodooluna"],sr:"marmemotes",tags:["luna",""],width:121},{apng_url:"http://backstage.berrytube.tv/marminator/images/a/84ozl2WMmiYp6Euf.png","background-image":"http://a.thumbs.redditmedia.com/84ozl2WMmiYp6Euf.png",height:140,names:["ivyrage","ierage"],sr:"marmemotes",tags:["oc",""],width:200},{apng_url:"http://backstage.berrytube.tv/marminator/images/a/E1FnMA0PMGL9qnwx.png","background-image":"http://a.thumbs.redditmedia.com/E1FnMA0PMGL9qnwx.png",height:140,names:["keystrokeguitar"],sr:"marmemotes",tags:["oc","berrytube"],width:118}],a.options=new EmoteExpansionOptions,a.expander=new EmoteExpander(a.sampleData,a.options),a.escapeHtml=function(a){var b=document.createElement("div");return b.appendChild(document.createTextNode(a)),b.innerHTML},a.serializeEmoteInfo=function(){var b=$("#afterSerialize"),c=a.emoteInfoSerializer.Serialize(a.emoteInfo);b.text(c);var d=$("#after-expansion"),e=$("#after-expansion-escaped"),f=c;console.log("running expansion on",f);var g=a.expander.expand(f);d.html("<p>Text <b>"+f+"</b> expanded to</p>"+g);var h=a.escapeHtml(g);e.html(h)}}]),angular.module("emotebuilderApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var EmoteEffectsModifier=function(){function a(){}return a.prototype.applyFlagsToEmote=function(a,b){var c=[],d=[],e=[],f=!1;("spin"===a.spin||"zspin"===a.spin||a.rotateDegrees||a.brody)&&(f=!0);var g=b;if(a.spin&&(c.push(a.spin+" 2s infinite linear"),"zspin"==a.spin||"spin"==a.spin)){var h=Math.sqrt(b.width()*b.width()+b.height()*b.height());g=this.wrapEmoteHeight(b,h)}if(a.slide){var i=[],j=a.speed||"8s";i.push(["slideleft",j,"infinite ease"].join(" ")),a.brody||a.spin||i.push("slide"==a.slide&&a.reverse?["!slideflip",j,"infinite ease"].join(" "):["slideflip",j,"infinite ease"].join(" ")),a.needsWrapper?d.push.apply(d,i):c.push.apply(c,i)}if(a.rotateDegrees){e.push("rotate("+a.rotateDegrees+"deg)");var k=b.width()*Math.abs(Math.sin(a.rotateDegrees*Math.PI/180))+b.height()*Math.abs(Math.cos(a.rotateDegrees*Math.PI/180));g=this.wrapEmoteHeight(b,k)}if(a.xAxisTranspose&&b.css("left",a.xAxisTranspose),a.zAxisTranspose&&b.css("z-index",a.zAxisTranspose),a.vibrate&&c.unshift("vibrate 0.05s infinite linear"),a.brody){c.push("brody  1.27659s infinite ease");var l=1.01*(b.width()*Math.sin(10*Math.PI/180)+b.height()*Math.cos(10*Math.PI/180));g=this.wrapEmoteHeight(b,l)}return a.reverse&&e.push("scaleX(-1)"),c.length>0&&b.css("animation",c.join(",").replace("!","-")),d.length>0&&b.parent().css("animation",d.join(",").replace("!","-")),e.length>0&&b.css("transform",e.join(" ")),g},a.prototype.wrapEmoteHeight=function(a,b){var c=Math.floor((b-a.height())/2);return a.wrap('<span class="rotation-wrapper" />').parent().css({height:Math.ceil(b-c),display:"inline-block","margin-top":c,position:"relative"})},a}(),isNode="undefined"!=typeof global&&"[object global]"=={}.toString.call(global);if(isNode)var _=require("underscore"),$=require("jquery");var EmoteExpander=function(){function a(a,b){this.regexp=/\[\]\(\/([\w:!#\/]+)([-\w!]*)([^)]*)\)/gi,this.debug=!0;var c=new EmoteMap(a);this.emoteHtml=new EmoteHtml(c,b),this.boundEmoteReplacer=this.emoteReplacer.bind(this)}return a.prototype.expand=function(a){var b=a.replace(this.regexp,this.boundEmoteReplacer);return b},a.prototype.emoteReplacer=function(a,b,c){var d=this.emoteHtml.getEmoteHtml(b,c);return d},a.prototype.debugLog=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];this.debug&&Function.prototype.apply.apply(console.log,[console,a])},a}();isNode&&(module.exports=EmoteExpander);var EmoteExpansionOptions=function(){function a(){this.berryEmoteEnabled=!0,this.berryEmotesEffects=!0,this.showNsfwEmotes=!0,this.berryDrunkMode=!1,this.berryEnableSlide=!0,this.berryEnableSpin=!0,this.berryEnableVibrate=!0,this.berryEnableTranspose=!0,this.berryEnableReverse=!0,this.berryEnableRotate=!0,this.berryEnableBrody=!0,this.berryEmoteBlacklist=[]}return a}(),EmoteFlags=function(){function a(a,b){this.berryEmoteAnimationSpeedMap={slowest:"14s",slower:"12s",slow:"10s",fast:"6s",faster:"4s",fastest:"2s"},this.berryEmoteSpinAnimations=["spin","zspin","xspin","yspin","!spin","!zspin","!xspin","!yspin"];var c=a.split("-");this.parseFlags(c,b)}return a.prototype.parseFlag=function(a,b){if("r"==a)b.berryEnableReverse&&(this.reverse=!0);else if("slide"==a||"!slide"==a)b.berryEnableSlide&&(this.slide=a);else if("brody"==a)b.berryEnableBrody&&(this.brody=!0);else if("vibrate"==a||"chargin"==a||"v"==a)b.berryEnableVibrate&&(this.vibrate=!0);else if(this.berryEmoteAnimationSpeedMap[a])this.speed=this.berryEmoteAnimationSpeedMap[a];else if(-1!=this.berryEmoteSpinAnimations.indexOf(a))b.berryEnableSpin&&(this.spin=a);else if(a.match(/^\d+$/))b.berryEnableRotate&&(this.rotateDegrees=parseInt(a));else if(a.match(/^s\d/))this.speed=a;else if(a.match(/^x\d+$/)){if(b.berryEnableTranspose){var c=+a.replace("x","");150>=c&&(this.xAxisTranspose=c)}}else if(a.match(/^!x\d+$/)){if(b.berryEnableTranspose){var d=+a.replace("!x","");d=-1*d,d>=-150&&(this.xAxisTranspose=d)}}else if(a.match(/^z\d+$/)){if(b.berryEnableTranspose){var e=+a.replace("z","");10>=e&&(this.zAxisTranspose=e)}}else console.log("failed to parse flag",a)},a.prototype.parseFlags=function(a,b){var c;for(c=0;c<a.length;++c)this.parseFlag(a[c],b)},a}(),EmoteHtml=function(){function a(a,b){this.emoteMap=a,this.emoteExpansionOptions=b,this.debug=!0,this.effectsModifier=new EmoteEffectsModifier}return a.prototype.isEmoteEligible=function(){return!0},a.prototype.getBaseEmote=function(a){var b=$("<span />").addClass("berryemote").attr("title",[a.names," from ",a.sr].join("")).css("height",a.height).css("width",a.width).css("display","inline-block").css("position","relative").css("overflow","hidden");return a.nsfw&&b.addClass("nsfw"),this.addBackgroundImage(b,a),b},a.prototype.addBackgroundImage=function(a,b){this.debugLog("Adding bgimage to ",a);var c=(b["background-position"]||["0px","0px"]).join(" ");a.css("background-position",c),a.css("background-image",["url(",b["background-image"],")"].join(""))},a.prototype.getEmoteHtml=function(a,b){var c=this.emoteMap.findEmote(a);if("undefined"==typeof c)return"Unable to find emote by name <b>"+a+"</b>";if(this.isEmoteEligible(c)===!1)return"[skipped expansion of emote "+a+"]";var d=this.getBaseEmote(c);if(b){var e=new EmoteFlags(b,this.emoteExpansionOptions),f=this.effectsModifier.applyFlagsToEmote(e,d);d=f}var g=d[0].outerHTML;return g},a.prototype.debugLog=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];this.debug&&Function.prototype.apply.apply(console.log,[console,arguments])},a}(),EmoteInfo=function(){function a(){}return a}(),EmoteInfoParser=function(){function a(){this.berryEmoteAnimationSpeedMap={slowest:"14s",slower:"12s",slow:"10s",fast:"6s",faster:"4s",fastest:"2s"},this.berryEmoteSpinAnimations=["spin","zspin","xspin","yspin","!spin","!zspin","!xspin","!yspin"]}return a.prototype.parseString=function(a){var b=new EmoteInfo,c=a.split("-");b.emoteName=c[0];var d=c.slice(1);this.parseFlags(d,b)},a.prototype.parseFlag=function(a,b){if("r"==a)b.reverse=!0;else if("slide"==a||"!slide"==a)b.slide=a;else if("brody"==a)b.brody=!0;else if("vibrate"==a||"chargin"==a||"v"==a)b.vibrate=!0;else if(this.berryEmoteAnimationSpeedMap[a])b.speed=this.berryEmoteAnimationSpeedMap[a];else if(-1!=this.berryEmoteSpinAnimations.indexOf(a))b.spin=a;else if(a.match(/^\d+$/))b.rotateDegrees=parseInt(a);else if(a.match(/^s\d/))b.speed=a;else if(a.match(/^x\d+$/)){var c=+a.replace("x","");150>=c&&(b.xAxisTranspose=c)}else if(a.match(/^!x\d+$/)){var d=+a.replace("!x","");d=-1*d,d>=-150&&(b.xAxisTranspose=d)}else if(a.match(/^z\d+$/)){var e=+a.replace("z","");10>=e&&(b.zAxisTranspose=e)}else console.log("failed to parse flag",a)},a.prototype.parseFlags=function(a,b){var c;for(c=0;c<a.length;++c)this.parseFlag(a[c],b)},a}(),isNode="undefined"!=typeof global&&"[object global]"=={}.toString.call(global);if(isNode)var _=require("underscore");var EmoteMap=function(){function a(a){this.emoteMap=this.buildEmoteMap(a)}return a.prototype.findEmote=function(a){return this.emoteMap[a]},a.prototype.buildEmoteMap=function(a){var b={};return _.each(a,function(a){_.each(a.names,function(c){b[c]=a})}),console.log("emote map",b),b},a}(),EmoteInfoSerializer=function(){function a(){}return a.prototype.Serialize=function(a){return"[](/"+a.emoteName+this.SerializeFlags(a)+")"},a.prototype.SerializeFlags=function(a){var b="";return a.vibrate&&(b+="-v"),a.reverse&&(b+="-r"),a.brody&&(b+="-brody"),a.invert&&(b+="-invert"),a.hueRotate&&(b+="-i"),a.speed&&(b+="-"+a.speed),a.slide&&(b+="-slide"),a.spin&&(b+="-"+a.spin),a.rotateDegrees&&(b+="-"+a.rotateDegrees),a.xAxisTranspose>0&&(b+="-x"+a.xAxisTranspose),a.xAxisTranspose<0&&(b+="-x!"+a.xAxisTranspose),a.zAxisTranspose>0&&(b+="-z"+a.zAxisTranspose),b},a}();